name: App - Build

on:
  workflow_dispatch:
    inputs:
      profile:
        description: "Profile"
        type: choice
        default: simulator
        required: true
        options:
          - development
          - simulator
          - preview
          - production
      submit:
        description: "Submit to AppStore"
        type: boolean
        required: true
        default: false

jobs:
  update:
    name: EAS Build
    runs-on: ubuntu-latest

    steps:
      - name: 🚚 Checkout
        uses: actions/checkout@v3
      - name: 🏗 Setup monorepo
        uses: ./.github/actions/setup-monorepo
        with:
          expo-token: ${{ secrets.EXPO_TOKEN }}
      - name: 📢 EAS Build
        run: eas build -e ${{ inputs.profile }} -p ios --non-interactive --no-wait
        working-directory: ./apps/app
        if: ${{ inputs.profile == 'simulator' || inputs.profile == 'development' || !inputs.submit }}
      - name: 📢 EAS Build and Submit
        run: eas build -e ${{ inputs.profile }} -p ios --non-interactive --no-wait --auto-submit
        working-directory: ./apps/app
        if: ${{ inputs.submit && inputs.profile == 'production' }}
